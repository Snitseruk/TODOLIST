<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>TO DO LIST</title>
</head>

<body>
    <section>
        <container>
            <div class="title">
                <h1>ToDo List</h1>
            </div>
            <div class="box">
                <form>
                    <input type="text" class="noteInput">
                    <button class="addNote">Add new</button>
                    <button type="button" class="toggleDone">Hide Done</button>
                </form>
                <ul class="noteList"> </ul>
            </div>

        </container>
    </section>
    <script src="https://kit.fontawesome.com/1da09caea0.js" crossorigin="anonymous"></script>
    <script>
        const LIST_NAME = 'todoList';
        const lsData = localStorage.getItem(LIST_NAME);
        const todo = {
            notes: lsData ? JSON.parse(lsData).notes : [],
            isShowDone: lsData ? JSON.parse(lsData).isShowDone : true,
        };
        const form = document.querySelector('form');
        const list = document.querySelector('.noteList');

        const tasksInPro = document.querySelector('.tasksInPro');
        const noteTemplate = ({ id, isShowDone, text }) => `
        <li data-id ="${id}" class ="noteItem${isShowDone ? 'done' : ''}">
            <span>${text}</span>
            <div class= "buttons">
                <input type="checkbox" ${isShowDone ? 'checked' : ''}>
                <button class = "editButton"><i class="far fa-edit"></i></button>
                <button class ="deleteButton"><i class="far fa-trash-alt"></i></button>
            </div>
        </li>`;

        todo.notes.forEach(note => {
            list.innerHTML += noteTemplate(note);
        });

        const saveToLs = todo => localStorage.setItem(LIST_NAME, JSON.stringify(todo));

        form.addEventListener('submit', e => {
            e.preventDefault();
            const input = e.target.children[0];
            indexElement = todo.notes.findIndex(function (note, index) {
                return note.text === input.value;
            });
            if (indexElement === -1) {
                const note = {
                    isShowDone: false,
                    text: input.value,
                    id: Math.random().toString(36).substr(2, 10),
                }
                list.innerHTML += noteTemplate(note);
                todo.notes.push(note);
                saveToLs(todo);
                input.value = '';
            } else { alert('this task is already exist'); }
        });

        list.addEventListener('click', e => {
            const targetEl = e.target;
            const li = targetEl.closest('.noteItem');
            const elId = li.dataset.id;
            if (targetEl.nodeName === 'INPUT') {
                const index = todo.notes.findIndex(note => note.id === elId);
                todo.notes[index].isShowDone = !todo.notes[index].isShowDone;
                saveToLs(todo);
                li.classList.toggle('done');
            }
            else if (targetEl.className === 'editButton') {
                let newText = prompt('Please, edit your note', 'note');
                const index = todo.notes.findIndex(note => note.id === elId);
                if (index !== -1) {
                    Object.assign(todo.notes[index], { text: newText })
                    saveToLs(todo)
                    const askEdit = confirm('do you want to save edition?');
                    if (askEdit == true) {
                        saveToLs(todo);
                    }
                } else {
                    alert('This note has already exist')
                };
            }
            else if (targetEl.className === 'deleteButton') {
                const index = todo.notes.findIndex(note => note.Id === elId);
                todo.notes.splice(index, 1);
                saveToLs(todo);
                const askRemove = confirm('do you want to delete?');
                if (askRemove == true) {
                    li.remove();
                }
            }
        });

        const hideButton = document.querySelector('.toggleDone');
        hideButton.addEventListener('click', e => {
            if (e.target.innerText === 'Hide done') {
                e.target.innerText = 'Show done';
            } else {
                e.target.innerText = 'Hide done'
            };
            const list = document.querySelector('.noteList');
            list.classList.toggle('hideDone');
        });




    </script>

</body>

</html>